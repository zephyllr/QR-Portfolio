function renderQR(){const e=document.getElementById("cardContent").value;let t=`http://api.qrserver.com/v1/create-qr-code/?data=${e}&size=225x225`;e||(t="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSmmUAO9kR7dbcHmMUXqDSk7Bzo0VDIG223CiYWsWcPj4akKzoGqA"),document.getElementById("qrImage").setAttribute("src",t),document.getElementById("submitCreate").style.display="",document.getElementById("previewCreate").style.display="none";}function togglePreviewCreate(){document.getElementById("submitCreate").style.display="none",document.getElementById("previewCreate").style.display="";}function mainCreate(){document.getElementById("cardContent").addEventListener("click",togglePreviewCreate),document.getElementById("previewCreate").addEventListener("click",renderQR);}function fetchData(e="",t={}){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});}function createElement(e,t,n,...a){const d=document.createElement(e);for(const e in t){d.setAttribute(e,t[e]);}d.textContent=n;for(let e=0;e<a.length;e++){d.appendChild(a[e]);}return d;}function main(){document.getElementById("createPage")&&mainCreate(),document.getElementById("portfolioPage")&&mainPortfolio(),document.getElementById("uploadPage")&&mainUpload();}async function deleteCard(e){e.preventDefault();const t=await fetchData(`/delete/${this.id}/`),n=await t.json();t.status>=200&&t.status<400?(portfolio.allCards=portfolio.allCards.filter(e=>e.id!==this.id),document.getElementById(this.id).remove()):console.log(n.error);}document.addEventListener("DOMContentLoaded",main);class AllCards{constructor(){this.allCards=[];}filterCards(e){this.allCards.forEach(t=>{document.getElementById(t.id).style.display=e.includes(t.cardName)?"":"none";});}showAllCards(){this.allCards.forEach(e=>document.getElementById(e.id).style.display="");}}class Card{constructor(e){this.id=e._id,this.cardName=e.cardName,this.qrCode=e.qrCode,this.cardContent=e.cardContent;}viewModalImage(){const e=document.getElementById("modal-body"),t=document.getElementById(this.id).getElementsByTagName("img")[0];e.textContent="",e.appendChild(t.cloneNode()),document.getElementById("modal-title").textContent=this.cardName;}render(){const e=createElement("button",{class:"btn btn-sm btn-outline-secondary btn-card","data-toggle":"modal","data-target":"#qrModal"},"View");e.addEventListener("click",this.viewModalImage.bind(this));const t=createElement("button",{class:"btn btn-sm btn-outline-secondary btn-card"},"Delete");t.addEventListener("click",deleteCard.bind(this));const n=createElement("div",null,null,e,t),a=createElement("div",{class:"justify-content-between align-items-center"},null,n),d=createElement("h3",null,this.cardName),l=createElement("div",{class:"card-body"},null,d,a),o=createElement("img",{src:this.qrCode,class:"img-thumbnail"}),s=createElement("div",{class:"card mb-3 shadow-sm"},null,o,l),c=createElement("div",{class:"col-md-3",id:this.id},null,s);document.getElementById("cards").appendChild(c);}}async function search(e){e.preventDefault();const t=document.getElementById("searchBar").value,n=await fetchData("/search/",{cardName:t}),a=await n.json();n.status>=200&&n.status<400?portfolio.filterCards(a):console.log(a.error);}function setUserName(e){document.getElementById("username").textContent=e;}async function getAllCards(){const e=await fetch("/loadPortfolio/"),t=await e.json();if(e.status>=200&&e.status<400){setUserName(t.username);const e=document.getElementById("cards");e.style.visibility="hidden",t.cards.forEach(e=>{const t=new Card(e);t.render(),portfolio.allCards.push(t);}),e.style.visibility="";}else {console.log(t.error);}}function clearSearch(e){e.preventDefault(),document.getElementById("searchBar").value=null,portfolio.showAllCards();}function mainPortfolio(){getAllCards(),document.getElementById("searchBar").addEventListener("keyup",search),document.getElementById("clearSearch").addEventListener("click",clearSearch);}const portfolio=new AllCards;async function scanQR(){const e=encodeURIComponent(document.getElementById("qrCode").value),t=await fetchData("/scan",{fileUrl:e}),n=await t.json();t.status>=200&&t.status<400?(document.getElementById("scannedContent").textContent=n,document.getElementById("submitUpload").style.display="",document.getElementById("scanUpload").style.display="none"):(errMsg="Unable to read QR Code. \n            Make sure the image address uses the right file extension and is a proper QR Code!",document.getElementById("scannedContent").textContent=errMsg,document.getElementById("submitUpload").style.display="none");}function toggleScanUpload(){document.getElementById("submitUpload").style.display="none",document.getElementById("scanUpload").style.display="";}function mainUpload(){document.getElementById("qrCode").addEventListener("click",toggleScanUpload),document.getElementById("scanUpload").addEventListener("click",scanQR);}